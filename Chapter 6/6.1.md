## 6.1 매직값을 반환하지 말아야 한다.

**매직값**은 함수의 정상적인 반환 값이지만 특별한 의미를 가지고 있는 것을 의미한다.

이는 정상적인 반환값이기에 이 값이 갖는 특별한 의미를 인지하지 못한다면 오류 값일 때도 정상적인 반환 값으로 오인하기 쉽다.

- 값이 없거나 오류가 발생 했을 경우 -1을 반환하는데 이를 인지하지 못한다면 정상 값이라고 오인하기 쉽다.

### 6.1.1 매직 값은 버그를 유발할 수 있다.

과거 에는 값이 없음을 나타캐기 위해 -1을 종종 반환했다.

당시에는 더 명시적인 오류전달 기법이나 널 , 옵셔널 타입 반환이 가능하지 않아서 어느정도 합리적 이유가 있었다.

하지만 일반적으로 매직값을 반환하면 **예측을 벗어날 위험**이 있으므로 사용하지 않는 것이 **바람직**하다.

```java
class User{
  ~~~
	Int getAge(){}
}
```

위 코드는 사용자의 나이를 반환하는 함수이다. `getAge`는 널이 아닌 정수를 반환하므로 다른 개발자가 함수 시그니처를 본다면 항상 사용 가능하다고 생각할 수 있다.

```java
for(User user in users){
	sumOfAges += user.getAge().toDouble();
}
```

누군가가 `user.getAge()`를 사용한다고 가정해보자. 위의 코드 작성자는 `getAge`에서 정수만 반환하므로 **항상** 사용자의 실제 나이를 반환한다고 생각할 것이다.

만약 `getAge` 함수에서 나이에 대한 잘못된 값으로 매직값 -1을 반환한다면  `sumOfAges` 작성자가 예측하지 못한 값 때문에 잘못 계산되어 질 수 있다.

이를 아래와 같은 코드로 나타냄으로써 나이에 대한 잘못된 값으로 매직값 -1을 반환하는 것을 `getAge` 메소드 사용자에게 나타낼 수 있다.

```java
Class User {
	private final Int? age;
	Int getAge(){
		if(age==null){
			return -1;
		}
		return age;
	}
}
```

이것은 귀찮지만 괜찮은 코드로 보이지만, 여러가지 문제점이 있다.

1. 이 코드가 정확히 어디서 어떻게 불리고 있는지 알지 못한다면 문제가 발생할 수 있다.
2. 단위 테스트가 이 문제를 발견하지 못할 수 있다. `sumOfAges`를 계산하는 작성자는 `User`한테 항상 나이가 있을 것이라는 확고한 믿음이 있다. 그래서 단위 테스트 코드에 사용되는 `User`들은 모두 나이를 가지고 있을 가능성이 크다. 그럴 경우 위와 같은 문제를 검증하지 못한다.

이에 대한 해결책은 이후에 설명된다.